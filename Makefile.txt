# 컴파일러 및 플래그 설정
CC = gcc
# -Wall, -Wextra: 모든 일반적인 경고 활성화
# -std=c99: C99 표준 사용
# -g: 디버깅 정보 포함
CFLAGS = -Wall -Wextra -std=c99 -g

# 최종 실행 파일 이름
TARGET = simulator

# 모든 소스 파일 목록
SRCS = main.c simulator.c memory.c log.c util.c

# 오브젝트 파일 목록 (자동 생성: .c -> .o)
OBJS = $(SRCS:.c=.o)

# ----------------------------------------------------------------------
# 주요 타겟 (Targets)
# ----------------------------------------------------------------------

.PHONY: all clean run

# 'all' 타겟: 기본 빌드 타겟. 오브젝트 파일을 링크하여 최종 실행 파일 생성.
all: $(TARGET)

# 실행 파일 생성: 오브젝트 파일들을 링크
$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) -o $@ $(OBJS)

# ----------------------------------------------------------------------
# 일반 컴파일 규칙
# ----------------------------------------------------------------------

# 각 .c 파일을 .o 파일로 컴파일
# $@: 타겟 이름 (예: main.o)
# $<: 첫 번째 종속 파일 (예: main.c)
%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# ----------------------------------------------------------------------
# 추가 유틸리티 타겟
# ----------------------------------------------------------------------

# 'run' 타겟: 시뮬레이터 실행 (예시)
# 이 타겟은 RR 정책과 예시 입력을 사용하도록 설정했습니다. 필요에 따라 수정하세요.
run: $(TARGET)
	@echo "Running simulator with example_input1 (RR Policy)..."
	./$(TARGET) -p RR -f ./example_input1 -l ./output_rr_1.log

# 'clean' 타겟: 빌드 파일 (.o, simulator) 삭제
clean:
	rm -f $(TARGET) $(OBJS)
	@echo "Cleaned up built files."